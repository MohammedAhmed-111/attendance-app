<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart School Attendance</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  body {
    font-family:'Segoe UI',sans-serif;
    margin:0;
    background:linear-gradient(135deg,#1e3c72,#2a5298,#3b6bb6,#4682b4,#5ba3d4);
    background-attachment:fixed;
    color:#1e293b;
  }
  .header, .login-card {
    background:rgba(255,255,255,0.95);
    padding:1rem 2rem;
    border-radius:12px;
    box-shadow:0 6px 20px rgba(0,0,0,0.1);
    margin:1rem auto;
    max-width:1000px;
  }
  .hidden {display:none;}
  .login-card {text-align:center;}
  .login-card input{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ccc;}
  .login-card button{padding:10px 20px;background:#1e3c72;color:white;border:none;border-radius:8px;cursor:pointer;}
  .login-card button:hover{background:#2a5298;}
  .container{max-width:1000px;margin:2rem auto;padding:0 1rem;}
  .card{background:rgba(255,255,255,0.95);padding:1.5rem;border-radius:15px;margin-bottom:1.5rem;box-shadow:0 6px 20px rgba(0,0,0,0.1);}
  .stats-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-top:1rem;}
  .stat-card{background:linear-gradient(135deg,#3b82f6,#60a5fa);color:white;padding:1rem;border-radius:15px;text-align:center;box-shadow:0 4px 15px rgba(0,0,0,0.2);}
  .stat-card h3{margin:0 0 0.5rem;}
  .stat-card p{margin:0;font-size:1.5rem;font-weight:bold;}
  table{width:100%;border-collapse:collapse;margin-top:15px;}
  th,td{padding:12px;text-align:center;}
  th{background:#1e3a8a;color:white;}
  tr:nth-child(even){background:#f3f4f6;}
  tr:hover{background:#e0f2fe;}
  button{padding:8px 14px;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;transition:.3s;}
  button:hover{transform:scale(1.05);}
  .btn-present{background:#22c55e;color:white;}
  .btn-absent{background:#ef4444;color:white;margin-left:5px;}
  .btn-export{background:#3b82f6;color:white;margin-top:10px;}
  .btn-add{background:#1e3a8a;color:white;margin-top:10px;}
  input{padding:10px;margin:6px 0;border:1px solid #d1d5db;border-radius:8px;width:100%;font-size:14px;}
  
  /* New styles for attendance methods */
  .attendance-methods {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }
  .method-card {
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    color: white;
    padding: 1.5rem;
    border-radius: 15px;
    text-align: center;
    cursor: pointer;
    transition: transform 0.3s, box-shadow 0.3s;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }
  .method-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  }
  .method-card.active {
    background: linear-gradient(135deg, #10b981, #059669);
  }
  .method-card i {
    font-size: 2rem;
    margin-bottom: 1rem;
  }
  .method-card h3 {
    margin: 0 0 0.5rem;
    font-size: 1.1rem;
  }
  .method-card p {
    margin: 0;
    font-size: 0.9rem;
    opacity: 0.9;
  }
  
  /* RFID Scanner */
  .rfid-scanner {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    padding: 2rem;
    border-radius: 15px;
    text-align: center;
    margin: 1rem 0;
  }
  .rfid-input {
    width: 80%;
    padding: 15px;
    font-size: 1.2rem;
    border-radius: 10px;
    border: 2px solid #fff;
    margin: 1rem 0;
  }
  
  /* QR Code Scanner */
  .qr-scanner {
    background: linear-gradient(135deg, #8b5cf6, #7c3aed);
    padding: 2rem;
    border-radius: 15px;
    text-align: center;
    margin: 1rem 0;
  }
  .qr-display {
    background: white;
    padding: 2rem;
    border-radius: 10px;
    margin: 1rem 0;
    display: inline-block;
  }
  
  /* Facial Recognition */
  .face-scanner {
    background: linear-gradient(135deg, #06b6d4, #0891b2);
    padding: 2rem;
    border-radius: 15px;
    text-align: center;
    margin: 1rem 0;
  }
  .camera-view {
    width: 300px;
    height: 200px;
    background: #1f2937;
    border-radius: 10px;
    margin: 1rem auto;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1rem;
  }
  
  .scanner-section {
    margin: 1rem 0;
  }
  
  .status-message {
    padding: 1rem;
    border-radius: 8px;
    margin: 1rem 0;
    font-weight: bold;
  }
  .status-success {
    background: #d1fae5;
    color: #065f46;
    border: 1px solid #a7f3d0;
  }
  .status-error {
    background: #fee2e2;
    color: #991b1b;
    border: 1px solid #fecaca;
  }
  .status-info {
    background: #dbeafe;
    color: #1e40af;
    border: 1px solid #93c5fd;
  }
</style>
</head>
<body>

<!-- Teacher Login -->
<div id="loginPage" class="login-card">
  <h2>Teacher Login</h2>
  <input type="text" id="teacherUser" placeholder="Username">
  <input type="password" id="teacherPass" placeholder="Password">
  <button onclick="login()">Login</button>
  <div id="loginError" style="color:red;margin-top:8px;"></div>
</div>

<!-- Main App -->
<div id="app" class="hidden">
  <header class="header">
    <h1>Smart Attendance System</h1>
    <nav>
      <button onclick="showPage('home')">Home</button>
      <button onclick="showPage('attendance')">Attendance</button>
      <button onclick="showPage('register')">Register</button>
      <button onclick="showPage('reports')">Reports</button>
      <button onclick="showPage('meals')">Meals</button>
    </nav>
  </header>

  <div class="container">
    <!-- Home -->
    <div id="home" class="card">
      <h2>Welcome 👋</h2>
      <p>Smart Attendance System helps rural schools mark attendance quickly and efficiently.</p>
      <div class="stats-container">
        <div class="stat-card"><h3>Total Students</h3><p id="totalStudents">0</p></div>
        <div class="stat-card"><h3>Present Today</h3><p id="totalPresent">0</p></div>
        <div class="stat-card"><h3>Absent Today</h3><p id="totalAbsent">0</p></div>
      </div>
      <img src="https://source.unsplash.com/800x200/?school,classroom" style="width:100%;border-radius:12px;margin-top:10px;">
    </div>

    <!-- Attendance -->
    <div id="attendance" class="card hidden">
      <h2>Mark Attendance</h2>
      
      <!-- Attendance Methods -->
      <h3>Choose Attendance Method:</h3>
      <div class="attendance-methods">
        <div class="method-card active" onclick="selectMethod('manual')" id="manual-method">
          <i class="fas fa-hand-paper"></i>
          <h3>Manual</h3>
          <p>Traditional click-based attendance</p>
        </div>
        <div class="method-card" onclick="selectMethod('rfid')" id="rfid-method">
          <i class="fas fa-id-card"></i>
          <h3>RFID Scanner</h3>
          <p>Scan student RFID cards</p>
        </div>
        <div class="method-card" onclick="selectMethod('qr')" id="qr-method">
          <i class="fas fa-qrcode"></i>
          <h3>QR Code</h3>
          <p>Scan QR codes for attendance</p>
        </div>
        <div class="method-card" onclick="selectMethod('face')" id="face-method">
          <i class="fas fa-user-check"></i>
          <h3>Face Recognition</h3>
          <p>AI-powered facial recognition</p>
        </div>
      </div>

      <!-- RFID Scanner Section -->
      <div id="rfid-section" class="scanner-section hidden">
        <div class="rfid-scanner">
          <i class="fas fa-id-card" style="font-size: 3rem; color: white; margin-bottom: 1rem;"></i>
          <h3 style="color: white; margin: 1rem 0;">RFID Attendance Scanner</h3>
          <p style="color: white; opacity: 0.9;">Place RFID card near scanner or enter card ID</p>
          <input type="text" class="rfid-input" id="rfidInput" placeholder="Scan RFID or enter Card ID" onkeypress="handleRfidInput(event)">
          <div>
            <button onclick="startRfidScan()" style="background: white; color: #f59e0b; margin: 0 5px;">Start Scanner</button>
            <button onclick="stopRfidScan()" style="background: #dc2626; color: white; margin: 0 5px;">Stop Scanner</button>
          </div>
          <div id="rfidStatus"></div>
        </div>
      </div>

      <!-- QR Code Scanner Section -->
      <div id="qr-section" class="scanner-section hidden">
        <div class="qr-scanner">
          <i class="fas fa-qrcode" style="font-size: 3rem; color: white; margin-bottom: 1rem;"></i>
          <h3 style="color: white; margin: 1rem 0;">QR Code Attendance Scanner</h3>
          <p style="color: white; opacity: 0.9;">Generate QR codes for students or scan existing ones</p>
          
          <div style="margin: 1rem 0;">
            <select id="qrStudentSelect" style="padding: 10px; margin: 0 10px; border-radius: 5px;">
              <option value="">Select student to generate QR</option>
            </select>
            <button onclick="generateQR()" style="background: white; color: #8b5cf6;">Generate QR</button>
          </div>
          
          <div id="qrDisplay" class="qr-display hidden">
            <div id="qrCode"></div>
            <p style="color: #333; margin-top: 10px;">Student QR Code</p>
          </div>
          
          <div style="margin: 1rem 0;">
            <input type="text" id="qrInput" placeholder="Scan QR code or enter code" 
                   style="padding: 10px; width: 60%; margin: 0 10px; border-radius: 5px;" 
                   onkeypress="handleQrInput(event)">
            <button onclick="startQrScan()" style="background: white; color: #8b5cf6;">Start Camera</button>
          </div>
          
          <div id="qrStatus"></div>
        </div>
      </div>

      <!-- Facial Recognition Section -->
      <div id="face-section" class="scanner-section hidden">
        <div class="face-scanner">
          <i class="fas fa-user-check" style="font-size: 3rem; color: white; margin-bottom: 1rem;"></i>
          <h3 style="color: white; margin: 1rem 0;">Facial Recognition Attendance</h3>
          <p style="color: white; opacity: 0.9;">AI-powered face detection and recognition</p>
          
          <div class="camera-view" id="cameraView">
            <i class="fas fa-video" style="font-size: 2rem; margin-right: 10px;"></i>
            Camera View
          </div>
          
          <div style="margin: 1rem 0;">
            <button onclick="startFaceRecognition()" style="background: white; color: #06b6d4; margin: 0 5px;">Start Recognition</button>
            <button onclick="stopFaceRecognition()" style="background: #dc2626; color: white; margin: 0 5px;">Stop Camera</button>
            <button onclick="trainFaceModel()" style="background: #059669; color: white; margin: 0 5px;">Train Model</button>
          </div>
          
          <div id="faceStatus"></div>
        </div>
      </div>

      <!-- Manual Attendance Table -->
      <div id="manual-section">
        <table id="attendanceTable"></table>
      </div>
    </div>

    <!-- Register -->
    <div id="register" class="card hidden">
      <h2>Add Student</h2>
      <input id="name" placeholder="Full Name">
      <input id="roll" placeholder="Roll Number">
      <input id="rfidCard" placeholder="RFID Card ID (Optional)">
      <button class="btn-add" onclick="addStudent()">Register</button>
    </div>

    <!-- Reports -->
    <div id="reports" class="card hidden">
      <h2>Reports</h2>
      <table id="reportTable"></table>
      <button class="btn-export" onclick="exportCSV()">Export CSV</button>
    </div>

    <!-- Meals -->
    <div id="meals" class="card hidden">
      <h2>Mid-Day Meals</h2>
      <ul id="mealList"></ul>
      <p><b>Total Meals Today:</b> <span id="totalMeals">0</span></p>
    </div>

  </div>
</div>

<script>
let students = [
  {id:1,name:"Rahul Sharma",roll:"101",present:false,rfidCard:"RFID001"},
  {id:2,name:"Anita Kumari",roll:"102",present:false,rfidCard:"RFID002"},
  {id:3,name:"Suresh Yadav",roll:"103",present:false,rfidCard:"RFID003"},
  {id:4,name:"Meena Rani",roll:"104",present:false,rfidCard:"RFID004"},
  {id:5,name:"Ravi Kumar",roll:"105",present:false,rfidCard:"RFID005"},
  {id:6,name:"Pooja Verma",roll:"106",present:false,rfidCard:"RFID006"},
  {id:7,name:"Arjun Singh",roll:"107",present:false,rfidCard:"RFID007"},
  {id:8,name:"Neha Patel",roll:"108",present:false,rfidCard:"RFID008"},
  {id:9,name:"Mohit Gupta",roll:"109",present:false,rfidCard:"RFID009"},
  {id:10,name:"Kavita Devi",roll:"110",present:false,rfidCard:"RFID010"}
];

let currentMethod = 'manual';
let rfidScanning = false;
let qrScanning = false;
let faceRecognition = false;

function saveData(){
  updateStats();
  loadAttendance();
  loadReports();
  loadMeals();
  updateQrStudentSelect();
}

function login(){
  const user = document.getElementById("teacherUser").value.trim();
  const pass = document.getElementById("teacherPass").value.trim();
  if(user==="teacher" && pass==="1234"){
    document.getElementById("loginPage").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    showPage("home");
    saveData();
  } else {
    document.getElementById("loginError").innerText = "Invalid username or password!";
  }
}

function showPage(page){
  document.querySelectorAll(".card").forEach(c=>c.classList.add("hidden"));
  document.getElementById(page).classList.remove("hidden");
  if(page==="attendance") loadAttendance();
  if(page==="reports") loadReports();
  if(page==="meals") loadMeals();
}

function updateStats(){
  document.getElementById("totalStudents").innerText = students.length;
  document.getElementById("totalPresent").innerText = students.filter(s=>s.present).length;
  document.getElementById("totalAbsent").innerText = students.filter(s=>!s.present).length;
}

function selectMethod(method) {
  currentMethod = method;
  
  // Update visual indicators
  document.querySelectorAll('.method-card').forEach(card => {
    card.classList.remove('active');
  });
  document.getElementById(method + '-method').classList.add('active');
  
  // Show/hide sections
  document.querySelectorAll('.scanner-section').forEach(section => {
    section.classList.add('hidden');
  });
  
  if (method === 'manual') {
    document.getElementById('manual-section').style.display = 'block';
  } else {
    document.getElementById('manual-section').style.display = 'none';
    document.getElementById(method + '-section').classList.remove('hidden');
  }
}

function loadAttendance(){
  let table = document.getElementById("attendanceTable");
  table.innerHTML = "<tr><th>Name</th><th>Roll</th><th>RFID</th><th>Status</th><th>Action</th></tr>";
  students.forEach(s=>{
    table.innerHTML += `<tr>
      <td>${s.name}</td>
      <td>${s.roll}</td>
      <td>${s.rfidCard || 'N/A'}</td>
      <td>${s.present?"✅ Present":"❌ Absent"}</td>
      <td>
        <button class="btn-present" onclick="markAttendance(${s.id},true)">Present</button>
        <button class="btn-absent" onclick="markAttendance(${s.id},false)">Absent</button>
        <button class="btn-absent" style="background:#6b7280;margin-left:5px;" onclick="deleteStudent(${s.id})">Delete</button>
      </td>
    </tr>`;
  });
}

function markAttendance(id, present, method = 'manual'){
  const s = students.find(x=>x.id===id);
  if(s){ 
    s.present = present;
    s.lastMethod = method;
    s.timestamp = new Date().toLocaleString();
    saveData();
    
    // Show success message
    showStatusMessage(`${s.name} marked as ${present ? 'Present' : 'Absent'} via ${method}`, 'success');
  }
}

function addStudent(){
  const name = document.getElementById("name").value.trim();
  const roll = document.getElementById("roll").value.trim();
  const rfidCard = document.getElementById("rfidCard").value.trim();
  
  if(name && roll){
    const newStudent = {
      id: Date.now(),
      name,
      roll,
      present: false,
      rfidCard: rfidCard || `RFID${Date.now()}`
    };
    students.push(newStudent);
    saveData();
    alert("Student Registered!");
    document.getElementById("name").value = "";
    document.getElementById("roll").value = "";
    document.getElementById("rfidCard").value = "";
    showPage('attendance');
  } else {
    alert("Please enter name and roll number.");
  }
}

// RFID Functions
function startRfidScan() {
  rfidScanning = true;
  document.getElementById("rfidInput").focus();
  showStatusMessage("RFID Scanner Active - Ready to scan cards", 'info', 'rfidStatus');
  
  setTimeout(() => {
    if (rfidScanning) {
      showStatusMessage("Waiting for RFID card... Place card near scanner", 'info', 'rfidStatus');
    }
  }, 1000);
}

function stopRfidScan() {
  rfidScanning = false;
  showStatusMessage("RFID Scanner Stopped", 'error', 'rfidStatus');
}

function handleRfidInput(event) {
  if (event.key === 'Enter') {
    const rfidValue = event.target.value.trim();
    if (rfidValue) {
      processRfidScan(rfidValue);
      event.target.value = '';
    }
  }
}

function processRfidScan(rfidValue) {
  const student = students.find(s => s.rfidCard === rfidValue);
  if (student) {
    markAttendance(student.id, true, 'RFID');
    showStatusMessage(`✅ ${student.name} (${student.roll}) - Present`, 'success', 'rfidStatus');
  } else {
    showStatusMessage(`❌ RFID card ${rfidValue} not found in system`, 'error', 'rfidStatus');
  }
}

// QR Code Functions
function updateQrStudentSelect() {
  const select = document.getElementById('qrStudentSelect');
  select.innerHTML = '<option value="">Select student to generate QR</option>';
  students.forEach(s => {
    select.innerHTML += `<option value="${s.id}">${s.name} (${s.roll})</option>`;
  });
}

function generateQR() {
  const studentId = document.getElementById('qrStudentSelect').value;
  if (!studentId) {
    alert('Please select a student');
    return;
  }
  
  const student = students.find(s => s.id == studentId);
  if (student) {
    const qrData = `STUDENT:${student.id}:${student.roll}:${student.name}`;
    document.getElementById('qrCode').innerHTML = `
      <div style="width: 150px; height: 150px; background: #333; color: white; display: flex; align-items: center; justify-content: center; margin: 0 auto; border-radius: 8px;">
        <div style="text-align: center;">
          <i class="fas fa-qrcode" style="font-size: 3rem; margin-bottom: 10px;"></i><br>
          <small>${student.roll}</small>
        </div>
      </div>
    `;
    document.getElementById('qrDisplay').classList.remove('hidden');
    showStatusMessage(`QR Code generated for ${student.name}`, 'success', 'qrStatus');
  }
}

function startQrScan() {
  qrScanning = true;
  showStatusMessage("QR Scanner Active - Point camera at QR code or enter code manually", 'info', 'qrStatus');
}

function handleQrInput(event) {
  if (event.key === 'Enter') {
    const qrValue = event.target.value.trim();
    if (qrValue) {
      processQrScan(qrValue);
      event.target.value = '';
    }
  }
}

function processQrScan(qrValue) {
  if (qrValue.startsWith('STUDENT:')) {
    const parts = qrValue.split(':');
    if (parts.length >= 4) {
      const studentId = parseInt(parts[1]);
      const student = students.find(s => s.id === studentId);
      
      if (student) {
        markAttendance(student.id, true, 'QR Code');
        showStatusMessage(`✅ ${student.name} (${student.roll}) - Present`, 'success', 'qrStatus');
      } else {
        showStatusMessage(`❌ Student not found in system`, 'error', 'qrStatus');
      }
    } else {
      showStatusMessage(`❌ Invalid QR code format`, 'error', 'qrStatus');
    }
  } else {
    showStatusMessage(`❌ Invalid QR code - not a student code`, 'error', 'qrStatus');
  }
}

// Facial Recognition Functions
function startFaceRecognition() {
  faceRecognition = true;
  document.getElementById('cameraView').innerHTML = `
    <div style="text-align: center;">
      <i class="fas fa-camera" style="font-size: 2rem; margin-bottom: 10px; color: #22c55e;"></i><br>
      <div style="font-size: 0.9rem;">Camera Active<br>Scanning for faces...</div>
    </div>
  `;
  showStatusMessage("Face Recognition Active - Please look at the camera", 'info', 'faceStatus');
  
  simulateFaceRecognition();
}

function stopFaceRecognition() {
  faceRecognition = false;
  document.getElementById('cameraView').innerHTML = `
    <i class="fas fa-video-slash" style="font-size: 2rem; margin-right: 10px;"></i>
    Camera Stopped
  `;
  showStatusMessage("Face Recognition Stopped", 'error', 'faceStatus');
}

function trainFaceModel() {
  showStatusMessage("Training AI model with student faces... This may take a few moments.", 'info', 'faceStatus');
  
  setTimeout(() => {
    showStatusMessage("✅ Face recognition model trained successfully with " + students.length + " student profiles", 'success', 'faceStatus');
  }, 3000);
}

function simulateFaceRecognition() {
  if (!faceRecognition) return;
  
  setTimeout(() => {
    if (faceRecognition) {
      const randomStudent = students[Math.floor(Math.random() * students.length)];
      const confidence = (85 + Math.random() * 10).toFixed(1);
      
      markAttendance(randomStudent.id, true, 'Face Recognition');
      showStatusMessage(`🎯 Face Detected: ${randomStudent.name} (${confidence}% confidence)`, 'success', 'faceStatus');
      
      setTimeout(() => simulateFaceRecognition(), 4000);
    }
  }, 3000);
}

function showStatusMessage(message, type, containerId = null) {
  const className = `status-${type}`;
  const statusHtml = `<div class="status-message ${className}">${message}</div>`;
  
  if (containerId) {
    document.getElementById(containerId).innerHTML = statusHtml;
  }
  
  if (type === 'success' && containerId) {
    setTimeout(() => {
      const container = document.getElementById(containerId);
      if (container && container.innerHTML.includes(message)) {
        container.innerHTML = '';
      }
    }, 3000);
  }
}

function loadReports(){
  let table = document.getElementById("reportTable");
  table.innerHTML = "<tr><th>Name</th><th>Roll</th><th>Status</th><th>Method</th><th>Time</th></tr>";
  students.forEach(s=>{
    table.innerHTML += `<tr>
      <td>${s.name}</td>
      <td>${s.roll}</td>
      <td>${s.present?"✅ Present":"❌ Absent"}</td>
      <td>${s.lastMethod || 'Manual'}</td>
      <td>${s.timestamp || 'N/A'}</td>
    </tr>`;
  });
}

function exportCSV(){
  let csv = "Name,Roll,Status,Method,Timestamp\n";
  students.forEach(s=>{ 
    csv+=`${s.name},${s.roll},${s.present?"Present":"Absent"},${s.lastMethod || 'Manual'},${s.timestamp || 'N/A'}\n`; 
  });
  const blob = new Blob([csv],{type:"text/csv"});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "attendance_report.csv";
  link.click();
}

function loadMeals(){
  const mealList = document.getElementById("mealList");
  const presentStudents = students.filter(s=>s.present);
  mealList.innerHTML = presentStudents.map(s=>`<li>🍲 ${s.name} (${s.roll})</li>`).join("");
  document.getElementById("totalMeals").innerText = presentStudents.length;
}

function deleteStudent(id){
  if(confirm("Are you sure you want to remove this student?")){
    students = students.filter(s => s.id !== id);
    saveData();
  }
}

// Initialize
saveData();
</script>

</body>
</html>
